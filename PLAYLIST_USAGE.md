# 播放列表功能使用说明

## 概述

Rust Audio Player 现在支持 M3U/M3U8 播放列表格式，让您可以轻松管理和播放多个音频文件。

## 功能特性

### ✅ 已实现功能

1. **M3U/M3U8 格式支持**
   - 支持标准的 M3U 和 M3U8 播放列表文件
   - 自动解析播放列表中的音频文件路径

2. **路径处理**
   - 支持绝对路径的音频文件
   - 支持相对于播放列表文件的相对路径
   - 自动处理路径解析和文件存在性检查

3. **播放控制**
   - 上一首/下一首按钮切换
   - 点击播放列表中的任意歌曲直接播放
   - 自动播放第一首歌曲

4. **界面显示**
   - 播放列表可视化显示
   - 当前播放歌曲标记（▶）
   - 显示歌曲名称和时长
   - 滚动列表支持

5. **错误处理**
   - 跳过不存在的文件
   - 显示警告信息
   - 优雅的错误处理

## 使用方法

### 1. 打开播放列表

1. 启动程序：`cargo run`
2. 点击"打开播放列表"按钮
3. 选择 M3U 或 M3U8 文件
4. 程序会自动解析并加载播放列表

### 2. 播放控制

- **播放/暂停**: 点击"播放/暂停"按钮
- **停止**: 点击"停止"按钮
- **上一首**: 点击"上一首"按钮切换到上一首歌曲
- **下一首**: 点击"下一首"按钮切换到下一首歌曲
- **直接选择**: 点击播放列表中的任意歌曲直接播放

### 3. 播放列表格式

支持标准的 M3U 格式：

```m3u
#EXTM3U
#EXTINF:180,Artist - Song 1
song1.mp3
#EXTINF:240,Artist - Song 2
song2.flac
#EXTINF:200,Artist - Song 3
song3.wav
```

### 4. 文件路径

**绝对路径**:
```m3u
/home/user/music/song1.mp3
C:\Music\song2.flac
```

**相对路径** (相对于播放列表文件):
```m3u
../music/song1.mp3
./songs/song2.flac
```

## 界面说明

### 播放列表显示

- **歌曲列表**: 显示播放列表中的所有歌曲
- **当前播放**: 当前播放的歌曲会标记为 ▶
- **歌曲信息**: 显示歌曲名称和时长
- **滚动支持**: 长播放列表支持滚动查看

### 控制按钮

- **打开文件**: 选择单个音频文件
- **打开播放列表**: 选择 M3U/M3U8 播放列表文件
- **播放/暂停**: 控制播放状态
- **停止**: 停止播放
- **上一首/下一首**: 在播放列表中切换歌曲

## 技术实现

### 核心组件

1. **Playlist 结构体**
   ```rust
   struct Playlist {
       items: Vec<PlaylistItem>,
       current_index: Option<usize>,
   }
   ```

2. **PlaylistItem 结构体**
   ```rust
   struct PlaylistItem {
       path: String,
       name: String,
       duration: Option<f64>,
   }
   ```

3. **M3U 解析函数**
   - `parse_m3u_playlist()`: 解析 M3U 文件
   - `is_m3u_playlist()`: 检查文件是否为播放列表

### 消息系统

新增的消息类型：
- `OpenPlaylist`: 打开播放列表对话框
- `PlaylistSelected`: 播放列表文件选择完成
- `PlaylistItemSelected`: 播放列表项选择
- `NextTrack`: 下一首歌曲
- `PreviousTrack`: 上一首歌曲

## 错误处理

程序会优雅地处理以下情况：

1. **文件不存在**: 跳过不存在的文件并显示警告
2. **格式错误**: 跳过格式错误的行
3. **空播放列表**: 显示错误信息
4. **路径解析错误**: 显示详细的错误信息

## 示例

### 创建播放列表

1. 创建文本文件，扩展名为 `.m3u` 或 `.m3u8`
2. 添加音频文件路径，每行一个文件
3. 可选：添加 `#EXTINF` 标签来指定时长和标题

示例文件 `my_playlist.m3u`:
```m3u
#EXTM3U
#EXTINF:180,My Song 1
/home/user/music/song1.mp3
#EXTINF:240,My Song 2
./local/song2.flac
#EXTINF:200,My Song 3
../shared/song3.wav
```

### 使用播放列表

1. 启动程序
2. 点击"打开播放列表"
3. 选择 `my_playlist.m3u` 文件
4. 程序会自动加载并开始播放第一首歌曲

## 未来计划

- [ ] 播放模式（循环、随机、单曲循环）
- [ ] 播放列表保存功能
- [ ] 拖放文件到播放列表
- [ ] 播放列表编辑功能
- [ ] 播放历史记录

---

*享受您的音乐播放体验！* 