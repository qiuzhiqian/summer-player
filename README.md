# Rust Audio Player

一个使用Rust编写的现代化图形界面音频播放器，使用iced GUI框架构建。

## 功能特性

- 🎵 **多格式支持**: 支持MP3、FLAC、WAV、OGG、AAC、M4A、M4S等多种音频格式
- 📋 **播放列表支持**: 支持M3U/M3U8播放列表格式
- 🎨 **现代GUI**: 使用iced框架构建的美观现代化界面
- 📁 **文件选择**: 内置文件选择器，支持多种音频格式过滤
- ⏯️ **播放控制**: 播放、暂停、停止功能
- ⏮️⏭️ **播放列表控制**: 上一首、下一首切换
- 🔊 **音量控制**: 可调节音量滑块
- 📊 **进度显示**: 显示播放进度条和时间信息
- 📈 **音频信息**: 显示音频文件的详细信息（采样率、声道数、比特率等）

## 依赖库

- **iced**: 图形用户界面框架
- **symphonia**: 音频解码库
- **cpal**: 跨平台音频库
- **rfd**: 文件对话框库
- **clap**: 命令行参数解析

## 编译和运行

### 系统要求

- Rust 1.70+
- Linux/Windows/macOS

### 编译

```bash
cargo build --release
```

### 运行

**图形界面模式**:
```bash
cargo run
```

**指定音频文件**:
```bash
cargo run -- path/to/audio/file.mp3
```

**命令行选项**:
```bash
# 显示帮助
cargo run -- --help

# 列出可用的音频输出设备
cargo run -- --list-devices

# 查看音频文件信息
cargo run -- --info path/to/audio/file.mp3
```

## 使用说明

### 图形界面操作

1. **打开文件**: 点击"打开文件"按钮选择单个音频文件
2. **打开播放列表**: 点击"打开播放列表"按钮选择M3U/M3U8播放列表文件
3. **播放/暂停**: 点击"播放/暂停"按钮
4. **停止**: 点击"停止"按钮停止播放并重置进度
5. **上一首/下一首**: 在播放列表模式下使用"上一首"和"下一首"按钮
6. **调节音量**: 拖动音量滑块调整音量（0-100%）
7. **播放列表选择**: 点击播放列表中的任意歌曲直接播放

### 界面说明

- **文件信息区**: 显示当前加载的文件名和音频格式信息
- **时间显示**: 显示当前播放时间和总时长
- **进度条**: 显示播放进度
- **控制按钮**: 文件选择、播放列表选择、播放控制
- **音量控制**: 音量滑块和百分比显示
- **播放列表**: 显示当前播放列表中的所有歌曲，当前播放歌曲会标记为▶

## 支持的音频格式

- MP3 (MPEG Audio Layer 3)
- FLAC (Free Lossless Audio Codec)
- WAV (Waveform Audio Format)
- OGG (Ogg Vorbis)
- AAC (Advanced Audio Codec)
- M4A (MPEG-4 Audio)
- M4S (MPEG-4 Segment)

## 播放列表支持

### M3U/M3U8格式

程序支持标准的M3U和M3U8播放列表格式：

```m3u
#EXTM3U
#EXTINF:180,Artist - Song 1
song1.mp3
#EXTINF:240,Artist - Song 2
song2.flac
#EXTINF:200,Artist - Song 3
song3.wav
```

### 播放列表功能

- **自动解析**: 自动解析M3U/M3U8文件中的音频文件路径
- **相对路径支持**: 支持相对于播放列表文件的相对路径
- **绝对路径支持**: 支持绝对路径的音频文件
- **时长显示**: 自动获取并显示每首歌曲的播放时长
- **错误处理**: 跳过不存在的文件并显示警告信息
- **播放控制**: 支持上一首/下一首切换
- **直接选择**: 点击播放列表中的任意歌曲直接播放

## 技术架构

### 模块化设计

项目采用模块化设计，将功能按领域分离：

- **`src/lib.rs`**: 库入口，重新导出主要类型
- **`src/error.rs`**: 统一的错误处理系统
- **`src/config.rs`**: 配置管理和常量定义
- **`src/utils.rs`**: 通用工具函数
- **`src/audio/`**: 音频处理模块
  - `file.rs`: 音频文件处理和信息提取
  - `device.rs`: 音频设备管理
  - `playback.rs`: 播放控制和状态管理
  - `decoder.rs`: 音频解码器
  - `stream.rs`: 音频流处理
- **`src/playlist.rs`**: 播放列表管理
- **`src/ui/`**: 用户界面模块
  - `app.rs`: 主应用程序逻辑
  - `messages.rs`: UI消息定义
  - `components.rs`: 可重用UI组件
- **`src/main.rs`**: 命令行入口和CLI处理

### 架构优势

- **模块化**: 清晰的功能分离和模块边界
- **可维护性**: 代码结构清晰，易于理解和修改
- **可扩展性**: 为新功能扩展提供良好基础
- **异步处理**: 文件选择和音频处理使用异步模式
- **响应式UI**: 基于消息传递的事件驱动架构
- **跨平台**: 支持Linux、Windows、macOS
- **类型安全**: 统一的错误处理和类型系统
- **测试友好**: 模块化设计便于单元测试

## 从TUI到GUI的迁移

这个项目原本是一个基于ratatui的终端界面(TUI)音频播放器，现在已经成功迁移到使用iced的图形界面(GUI)：

### 主要改进

1. **用户界面**: 从终端文本界面升级为现代化图形界面
2. **交互方式**: 从键盘快捷键改为鼠标点击操作
3. **可视化**: 更直观的进度条、按钮和滑块
4. **文件选择**: 集成文件选择器，无需命令行参数
5. **播放列表**: 新增完整的播放列表支持功能

### 保留功能

- 音频解码和播放核心逻辑
- 多格式音频支持
- 音频设备管理
- 错误处理机制

## 开发计划

### 已完成 ✅
- [x] 实现真正的音频播放功能
- [x] 添加播放列表功能
- [x] 模块化代码重构
- [x] 统一错误处理系统
- [x] 完善文档和注释

### 进行中 🚧
- [ ] 清理编译警告
- [ ] 添加更多单元测试

### 计划中 📋
- [ ] 添加播放进度条拖拽跳转功能
- [ ] 添加音频可视化
- [ ] 添加均衡器
- [ ] 添加拖放文件支持
- [ ] 添加键盘快捷键
- [ ] 添加主题切换功能
- [ ] 添加播放状态实时同步
- [ ] 添加播放模式（循环、随机等）
- [ ] 添加播放列表保存功能
- [ ] 性能优化和内存使用改进

## 许可证

MIT License - 详见LICENSE文件

## 贡献

欢迎提交问题和拉取请求！

---

*使用Rust和iced构建的现代化音频播放器* 